<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, viewport-fit=cover"
        />

        <title>Undangan Mepradang dan Mepejati</title>

        <!-- Bootstrap 5 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
            rel="stylesheet"
            crossorigin="anonymous"
        />

        <!-- Bootstrap 5 Icons -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
        />

        <!-- CSS Externals -->
        <link rel="stylesheet" href="style.css" />

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Playwrite+CA:wght@100..400&family=Work+Sans:ital,wght@0,100..900;1,100..900&display=swap"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Patua+One&display=swap"
            rel="stylesheet"
        />

        <!-- Simply Countdown -->
        <link rel="stylesheet" href="dist-countdown/themes/default.css" />

        <!-- Animate on Scroll -->
        <link
            rel="stylesheet"
            href="https://unpkg.com/aos@2.3.1/dist/aos.css"
        />

        <!-- FontAwesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css"
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        />

        <!-- Favicon -->
        <link
            rel="icon"
            href="favicon.png?v=2"
            sizes="32x32"
            type="image/png"
        />
    </head>

    <body>
        <!-- Section landing-page -->
        <section id="landing-page" class="landing-page">
            <div class="safe-area">
                <div class="guest-box guest-row">
                    <h3 class="myFont">
                        Undangan <br class="br-mobile" />
                        Mepradang &amp; Mepejati
                    </h3>
                    <img
                        src="src/img/assets/amkara.png"
                        alt="Om Symbol"
                        class="guest-ornament"
                    />
                    <p>Kepada Yth.</p>
                    <p>Bapak/Ibu/Saudara/I</p>
                    <h3 class="guest-name">Tamu Undangan</h3>
                    <a href="#wedding-title" class="btn-enter"
                        ><i class="fa-solid fa-envelope"></i>Buka Undangan</a
                    >
                </div>
            </div>
        </section>

        <!-- Section Wedding Title -->
        <section id="wedding-title" class="wedding-title">
            <div class="ornament-top">
                <img
                    data-aos="fade-down"
                    data-aos-duration="2000"
                    data-aos-offset="0"
                    src="src/img/assets/ornamentTop.png"
                    alt="Ornament Top"
                />
            </div>

            <div class="wedding-text">
                <div class="wedding-container">
                    <p class="subtitle">The Wedding Of</p>
                    <h1 class="bride-groom">Dhani & Ditha</h1>
                </div>
            </div>

            <div class="ornament-bottom">
                <img
                    data-aos="fade-up"
                    data-aos-duration="2000"
                    data-aos-offset="0"
                    src="src/img/assets/ornamentBottom.png"
                    alt="Ornament Bottom"
                />
            </div>
        </section>

        <!-- Section Doa -->
        <section id="doa" class="doa">
            <!-- Ornament Background -->
            <div class="doa-ornaments">
                <img
                    src="src/img/assets/frame.png"
                    class="ornament bottom-left"
                    alt="ornament"
                />
                <img
                    src="src/img/assets/frame.png"
                    class="ornament bottom-right"
                    alt="ornament"
                />
            </div>

            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-10 py-5">
                        <img
                            class="img-omswastyastu"
                            src="src/img/assets/om-swastyastu.png"
                            alt="Om Swastyastu"
                            style="margin-bottom: 12px"
                        />
                        <h2 class="title-omSwastyastu">Om Swastyastu</h2>

                        <p class="veda-verse" style="text-align: justify">
                            <i>
                                Iha-imƒÅv-indra sam nuda CakravƒÅkeva dampati.
                            </i>
                        </p>

                        <h5 class="veda-title">
                            <i class="fa-solid fa-book"></i> Atharvaveda :
                            XIV.2.64
                        </h5>

                        <p class="veda-meaning" style="text-align: justify">
                            Ya Tuhan, karuniailah kepada pasangan ini untuk
                            memiliki cinta kasih yang tulus dalam membina
                            kehidupan berumah tangga.
                        </p>

                        <p class="title-doa" style="text-align: justify">
                            Atas Asung Kertha Wara Nugraha Ida Sang Hyang Widhi
                            Wasa/Tuhan Yang Maha Esa, perkenankan kami
                            mengundang Bapak/Ibu/Saudara/I pada Acara Mepradang
                            & Mepejati putri kami.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section Groom and Bride  -->
        <section id="couple" class="couple-section">
            <div class="overlay-gradient"></div>

            <div class="couple-content">
                <!-- Groom -->
                <div
                    class="person groom"
                    data-aos="fade-right"
                    data-aos-duration="2000"
                >
                    <h3 class="nickname">Dhani</h3>
                    <h4 class="fullname">Yandhani Astika Putra, S.T.</h4>
                    <p class="parents">
                        Putra pertama dari <br />
                        Drs. I Wayan Suriada <br />
                        &amp; <br />
                        Ni Nengah Ayu Hastina Wathy, S.Pd.
                    </p>

                    <a
                        class="btn-ig"
                        href="https://www.instagram.com/yandhaniastika/"
                        target="_blank"
                        rel="noopener noreferrer"
                    >
                        <svg
                            class="ig-icon"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                        >
                            <rect
                                x="3"
                                y="3"
                                width="18"
                                height="18"
                                rx="5"
                                ry="5"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="12"
                                cy="12"
                                r="3.8"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="17.3"
                                cy="6.7"
                                r="1.2"
                                fill="currentColor"
                            />
                        </svg>
                        Instagram Dhani
                    </a>
                </div>

                <!-- Bride -->
                <div
                    class="person bride"
                    data-aos="fade-left"
                    data-aos-duration="2000"
                >
                    <h3 class="nickname">Ditha</h3>
                    <h4 class="fullname">Putu Ditha Putri Cahyani, S.K.M.</h4>
                    <p class="parents">
                        Putri pertama dari <br />
                        AKBP (Purn.) I Ketut Perten <br />
                        & <br />
                        Ni Made Warniki, S.E.
                    </p>

                    <!-- ‚¨áÔ∏è Tombol Instagram Bride -->
                    <a
                        class="btn-ig"
                        href="https://www.instagram.com/dithacahyani/"
                        target="_blank"
                        rel="noopener noreferrer"
                    >
                        <svg
                            class="ig-icon"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                        >
                            <rect
                                x="3"
                                y="3"
                                width="18"
                                height="18"
                                rx="5"
                                ry="5"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="12"
                                cy="12"
                                r="3.8"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="17.3"
                                cy="6.7"
                                r="1.2"
                                fill="currentColor"
                            />
                        </svg>
                        Instagram Ditha
                    </a>
                </div>
            </div>
        </section>

        <!-- Section Couple - Mobile Only -->
        <section
            id="couple-mobile"
            class="couple-mobile"
            aria-label="Couple (Mobile)"
        >
            <!-- Groom -->
            <div class="mobile-person groom" role="group" aria-label="Groom">
                <span class="mobile-overlay" aria-hidden="true"></span>
                <div
                    class="mobile-text"
                    data-aos="fade-up"
                    data-aos-duration="2000"
                >
                    <h3 class="nickname">Dhani</h3>
                    <h4 class="fullname">Yandhani Astika Putra, S.T.</h4>
                    <p class="parents">
                        Putra pertama dari <br />
                        Drs. I Wayan Suriada <br />
                        &amp; <br />
                        Ni Nengah Ayu Hastina Wathy, S.Pd.
                    </p>

                    <!-- ‚¨áÔ∏è Tombol Instagram Bride -->
                    <a
                        class="btn-ig"
                        href="https://www.instagram.com/yandhaniastika/"
                        target="_blank"
                        rel="noopener noreferrer"
                    >
                        <svg
                            class="ig-icon"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                        >
                            <rect
                                x="3"
                                y="3"
                                width="18"
                                height="18"
                                rx="5"
                                ry="5"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="12"
                                cy="12"
                                r="3.8"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="17.3"
                                cy="6.7"
                                r="1.2"
                                fill="currentColor"
                            />
                        </svg>
                        Instagram Dhani
                    </a>
                </div>
            </div>

            <!-- Bride -->
            <div class="mobile-person bride" role="group" aria-label="Bride">
                <span class="mobile-overlay" aria-hidden="true"></span>
                <div
                    class="mobile-text"
                    data-aos="fade-up"
                    data-aos-duration="2000"
                >
                    <h3 class="nickname">Ditha</h3>
                    <h4 class="fullname">Putu Ditha Putri Cahyani, S.K.M.</h4>
                    <p class="parents">
                        Putri pertama dari <br />
                        AKBP (Purn.) I Ketut Perten <br />
                        &amp; <br />
                        Ni Made Warniki, S.E.
                    </p>

                    <!-- ‚¨áÔ∏è Tombol Instagram Groom -->
                    <a
                        class="btn-ig"
                        href="https://www.instagram.com/dithacahyani/"
                        target="_blank"
                        rel="noopener noreferrer"
                    >
                        <svg
                            class="ig-icon"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                        >
                            <rect
                                x="3"
                                y="3"
                                width="18"
                                height="18"
                                rx="5"
                                ry="5"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="12"
                                cy="12"
                                r="3.8"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="1.8"
                            />
                            <circle
                                cx="17.3"
                                cy="6.7"
                                r="1.2"
                                fill="currentColor"
                            />
                        </svg>
                        Instagram Ditha
                    </a>
                </div>
            </div>
        </section>

        <!-- Section: Wedding Date -->
        <section
            id="wedding-date"
            class="wedding-date-section"
            aria-label="Wedding Date"
        >
            <span class="wd-overlay" aria-hidden="true"></span>

            <div class="wd-container">
                <h2 class="wd-title">Save Our Date</h2>

                <!-- Event details (vertical) -->
                <div class="event-list">
                    <div
                        class="event-card"
                        data-aos="zoom-in"
                        data-aos-duration="1500"
                    >
                        <h3 class="event-title">Mepradang dan Mepejati</h3>
                        <p class="event-date">Minggu, 2 November 2025</p>
                        <p class="event-time">11.00 - 14.00 WITA</p>
                        <p class="event-location">
                            Banjar Petak, Desa Petak Kaja, Kab. Gianyar, Bali
                        </p>
                    </div>
                    <!-- Countdown (vanilla, no library) -->
                    <!-- HTML -->
                    <div
                        id="countdown-02"
                        class="wd-countdown"
                        role="timer"
                        aria-live="polite"
                        data-aos="zoom-in"
                        data-aos-duration="1500"
                    >
                        <div class="cd-item">
                            <span class="cd-value" data-part="days">00</span
                            ><span class="cd-label">Days</span>
                        </div>
                        <div class="cd-item">
                            <span class="cd-value" data-part="hours">00</span
                            ><span class="cd-label">Hours</span>
                        </div>
                        <div class="cd-item">
                            <span class="cd-value" data-part="mins">00</span
                            ><span class="cd-label">Minutes</span>
                        </div>
                        <div class="cd-item">
                            <span class="cd-value" data-part="secs">00</span
                            ><span class="cd-label">Seconds</span>
                        </div>
                    </div>
                </div>

                <!-- Google Maps button (dummy link) -->
                <a
                    class="btn-map"
                    href="https://maps.app.goo.gl/VjN3vj28rMamHrQy6"
                    target="_blank"
                    rel="noopener"
                >
                    <i class="fa-solid fa-map-location-dot"></i> Open in Google
                    Maps
                </a>
            </div>
        </section>

        <section id="gallery" class="gallery-section">
            <div class="overlay"></div>
            <div class="container py-5 position-relative">
                <h2 class="text-center mb-5 gallery-title">
                    Pre-Wedding Gallery
                </h2>
                <div class="gallery-grid2">
                    <img
                        src="src/img/gallery/gallery2/g1.webp"
                        alt="Gallery 1"
                        class="portrait"
                    />
                    <img
                        src="src/img/gallery/gallery2/g2.webp"
                        alt="Gallery 2"
                        class="portrait"
                    />
                    <img
                        src="src/img/gallery/gallery2/g3.webp"
                        alt="Gallery 3"
                        class="landscape"
                    />
                    <img
                        src="src/img/gallery/gallery2/g4.webp"
                        alt="Gallery 3"
                        class="landscape"
                    />

                </div>
            </div>
        </section>

        <!-- Lightbox -->
        <!-- Lightbox -->
        <div
            id="lightbox"
            class="lb"
            role="dialog"
            aria-modal="true"
            aria-hidden="true"
        >
            <figure class="lb-stage" aria-live="polite">
                <img id="lb-image" alt="" decoding="async" />
                <figcaption class="lb-footnote">
                    Swipe to the Next Image
                </figcaption>
            </figure>

            <!-- Tombol fixed -->
            <button
                type="button"
                class="lb-btn lb-close"
                aria-label="Close (Esc)"
            >
                √ó
            </button>
            <button
                type="button"
                class="lb-btn lb-prev"
                aria-label="Previous (‚Üê)"
            >
                ‚Äπ
            </button>
            <button type="button" class="lb-btn lb-next" aria-label="Next (‚Üí)">
                ‚Ä∫
            </button>
        </div>

        <!-- Section Penutup -->
        <section id="closing" class="closing" aria-label="Penutup">
            <div class="safe-area">
                <div class="closing__inner">
                    <p class="closing__quote text-center">
                        SETIAP UCAPAN DAN DOA YANG DIBERIKAN, JADI BAGIAN INDAH
                        DALAM CERITA KAMI.
                    </p>

                    <h3 class="closing__names">
                        Dhani
                        <span class="closing__icon" aria-hidden="true"></span>
                        Ditha
                        <!-- kamu bisa ganti background-image di CSS untuk icon ini -->
                    </h3>
                    <h2 class="title-omShanti text-center">
                        Om Shanti Shanti Shanti Om
                    </h2>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <!-- Footer -->
        <footer
            id="site-footer"
            class="site-footer"
            role="contentinfo"
            aria-label="Footer"
        >
            <div class="">
                <div class="footer__inner">
                    <p class="footer__copy">
                        <span class="year">2025</span>
                        <i
                            class="fa-regular fa-copyright"
                            aria-hidden="true"
                        ></i>
                        Made with ü´∂üèª ‚Äî <strong>Dekwid Aryama Putra</strong>
                    </p>

                    <nav class="footer__socials" aria-label="Social media">
                        <!-- Ganti href="#" ke link kamu -->
                        <a
                            href="https://www.instagram.com/dekwidap/"
                            class="social-link"
                            aria-label="Instagram"
                            target="_blank"
                            rel="noopener"
                        >
                            <i
                                class="fa-brands fa-instagram"
                                aria-hidden="true"
                            ></i>
                        </a>
                        <a
                            href="https://www.facebook.com/dekwidaryama/"
                            class="social-link"
                            aria-label="Facebook"
                            target="_blank"
                            rel="noopener"
                        >
                            <i
                                class="fa-brands fa-facebook-f"
                                aria-hidden="true"
                            ></i>
                        </a>
                        <a
                            href="https://github.com/dekwidap"
                            class="social-link"
                            aria-label="GitHub"
                            target="_blank"
                            rel="noopener"
                        >
                            <i
                                class="fa-brands fa-github"
                                aria-hidden="true"
                            ></i>
                        </a>
                    </nav>
                </div>
            </div>
        </footer>

        <!-- Musik -->
        <!-- Background music (mulai setelah Open Invitation) -->
        <audio id="bgm" preload="none" loop>
            <!-- utamakan m4a, tambah mp3 kalau ada -->
            <source src="src/audio/bgSound.m4a" type="audio/mp4" />
            <!-- <source src="src/audio/bgm.mp3" type="audio/mpeg"> -->
        </audio>

        <!-- Floating play/pause button -->
        <button
            id="music-toggle"
            class="music-btn"
            aria-label="Play music"
            aria-pressed="false"
        >
            <i class="fa-solid fa-play"></i>
        </button>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // ====== SET TARGET WAKTU (WITA = UTC+08:00) ======
                const EVENT_DATE = new Date("2025-11-02T11:00:00+08:00"); // 2 Nov 2025, 11:00 WITA

                // Root countdown khusus LP-2
                const root = document.getElementById("countdown-02");
                if (!root) return; // diam saja kalau elemen tidak ada

                // Ambil elemen angka
                const el = {
                    d: root.querySelector('[data-part="days"]'),
                    h: root.querySelector('[data-part="hours"]'),
                    m: root.querySelector('[data-part="mins"]'),
                    s: root.querySelector('[data-part="secs"]'),
                };

                const pad = (n) => n.toString().padStart(2, "0");

                function renderZero() {
                    el.d && (el.d.textContent = "00");
                    el.h && (el.h.textContent = "00");
                    el.m && (el.m.textContent = "00");
                    el.s && (el.s.textContent = "00");
                }

                function tick() {
                    const diff = EVENT_DATE.getTime() - Date.now();

                    if (diff <= 0) {
                        renderZero();
                        clearInterval(timer);
                        return;
                    }

                    const sec = Math.floor(diff / 1000);
                    const days = Math.floor(sec / 86400);
                    const hrs = Math.floor((sec % 86400) / 3600);
                    const mins = Math.floor((sec % 3600) / 60);
                    const secs = sec % 60;

                    el.d && (el.d.textContent = pad(days));
                    el.h && (el.h.textContent = pad(hrs));
                    el.m && (el.m.textContent = pad(mins));
                    el.s && (el.s.textContent = pad(secs));
                }

                tick();
                const timer = setInterval(tick, 1000);

                // Inisialisasi AOS bila tersedia (supaya elemen data-aos tampil)
                if (window.AOS && typeof AOS.init === "function") {
                    AOS.init();
                }
            });
        </script>

        <!-- Bootstrap 5 -->
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
            crossorigin="anonymous"
        ></script>

        <!-- Simply Countdown JS -->
        <script src="dist-countdown/simplyCountdown.umd.js"></script>

        <!-- Light Box Image -->
        <script src="https://cdn.jsdelivr.net/npm/bs5-lightbox@1.8.5/dist/index.bundle.min.js"></script>

        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

        <script>
            (() => {
                const imgs = document.querySelectorAll(".gallery-grid2 img");
                if (!imgs.length) return;

                const lb = document.getElementById("lightbox");
                const stage = lb.querySelector(".lb-stage");
                const lbImg = document.getElementById("lb-image");
                const btnPrev = lb.querySelector(".lb-prev");
                const btnNext = lb.querySelector(".lb-next");
                const btnClose = lb.querySelector(".lb-close");

                let idx = 0;
                let isOpen = false;
                const SWIPE_THRESHOLD = 40;

                // --- Helpers ---
                const clampIndex = (i) => (i + imgs.length) % imgs.length;

                const setReady = (ready) => {
                    if (ready) lbImg.classList.add("is-ready");
                    else lbImg.classList.remove("is-ready");
                };

                const preload = (i) => {
                    const el = imgs[clampIndex(i)];
                    const s = el.currentSrc || el.src;
                    const im = new Image();
                    im.decoding = "async";
                    im.src = s;
                };

                const showImage = (i) => {
                    idx = clampIndex(i);
                    setReady(false);
                    const el = imgs[idx];
                    const src = el.currentSrc || el.src;
                    const alt = el.alt || "";

                    // Preload target dulu untuk transisi halus
                    const pre = new Image();
                    pre.decoding = "async";
                    pre.onload = () => {
                        if (!isOpen) return;
                        lbImg.src = src;
                        lbImg.alt = alt;
                        // requestAnimationFrame untuk memastikan browser commit style sebelum fade
                        requestAnimationFrame(() => setReady(true));
                        // Preload tetangga
                        preload(idx + 1);
                        preload(idx - 1);
                    };
                    pre.src = src;
                };

                const open = (i) => {
                    isOpen = true;
                    lb.classList.add("show");
                    lb.setAttribute("aria-hidden", "false");
                    document.documentElement.classList.add("no-scroll");
                    showImage(i);
                    btnClose.focus();
                };

                const closeIfOutsideImage = (e) => {
                    if (!isOpen) return;
                    const onBtn = e.target.closest(".lb-btn");
                    const onImg = e.target.closest("#lb-image");
                    if (onBtn) return; // klik tombol: jangan tutup
                    if (!onImg) close(); // bukan gambar? tutup
                };

                // Pakai click (desktop & sebagian besar mobile)
                lb.addEventListener("click", closeIfOutsideImage);
                // Tambah touchstart supaya responsif di mobile
                lb.addEventListener("touchstart", closeIfOutsideImage, {
                    passive: true,
                });

                const close = () => {
                    isOpen = false;
                    lb.classList.remove("show");
                    lb.setAttribute("aria-hidden", "true");
                    document.documentElement.classList.remove("no-scroll");
                    setReady(false);
                };

                const next = () => showImage(idx + 1);
                const prev = () => showImage(idx - 1);

                // --- Bind gallery thumbs (1x saja) ---
                imgs.forEach((img, i) => {
                    img.dataset.index = i;
                    img.style.cursor = "pointer";
                    img.tabIndex = 0;
                    img.addEventListener("click", () => open(i));
                    img.addEventListener("keydown", (e) => {
                        if (e.key === "Enter" || e.key === " ") open(i);
                    });
                });

                // --- Buttons ---
                btnClose.addEventListener("click", close);
                btnNext.addEventListener("click", next);
                btnPrev.addEventListener("click", prev);

                // --- Overlay click: tutup jika klik di luar stage atau tombol ---
                lb.addEventListener("click", (e) => {
                    if (!isOpen) return;
                    const hitStage = e.target.closest(".lb-stage");
                    const hitBtn = e.target.closest(".lb-btn");
                    if (!hitStage && !hitBtn) close();
                });

                // --- Keyboard nav (global, tapi ringan) ---
                document.addEventListener(
                    "keydown",
                    (e) => {
                        if (!isOpen) return;
                        if (e.key === "Escape") close();
                        else if (e.key === "ArrowRight") next();
                        else if (e.key === "ArrowLeft") prev();
                    },
                    { passive: true }
                );

                // --- Swipe (Pointer Events, 1 handler utk mouse/touch/pen) ---
                let startX = 0,
                    startY = 0;
                stage.addEventListener(
                    "pointerdown",
                    (e) => {
                        if (!isOpen) return;
                        startX = e.clientX;
                        startY = e.clientY;
                        // optional: stage.setPointerCapture?.(e.pointerId);
                    },
                    { passive: true }
                );

                stage.addEventListener(
                    "pointerup",
                    (e) => {
                        if (!isOpen) return;
                        const dx = e.clientX - startX;
                        const dy = e.clientY - startY;
                        if (
                            Math.abs(dx) > Math.abs(dy) &&
                            Math.abs(dx) > SWIPE_THRESHOLD
                        ) {
                            dx < 0 ? next() : prev();
                        }
                    },
                    { passive: true }
                );
            })();
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const targets = document.querySelectorAll(".guest-name");
                if (!targets.length) return;

                const params = new URLSearchParams(window.location.search);
                let to = params.get("to"); // ex: ?to=Dekwid%20Aryama%20Putra
                if (to == null) return; // tanpa param: biarkan default di HTML

                // Decode & rapikan
                to = to.replace(/\+/g, " "); // dukung ?to=Nama+Tamu
                try {
                    to = decodeURIComponent(to);
                } catch (e) {}
                to = to.replace(/[_-]+/g, " "); // ganti _ atau - jadi spasi
                to = to.trim().replace(/\s{2,}/g, " ");

                // (opsional) Title Case ‚Äî hapus komentar kalau mau otomatis kapital awal kata
                // to = to.replace(/\w\S*/g, w => w[0].toUpperCase() + w.slice(1).toLowerCase());

                if (to) {
                    if (to.length > 80) to = to.slice(0, 80) + "‚Ä¶"; // cegah nama terlalu panjang
                    targets.forEach((el) => (el.textContent = to)); // aman dari XSS
                }
            });
        </script>

        <script>
            // MUSIC ‚Äî tampil & auto-play jika user pernah membuka undangan
            (function () {
                const audio = document.getElementById("bgm");
                const btn = document.getElementById("music-toggle"); // <button id="music-toggle" class="music-btn">...</button>
                const icon = btn.querySelector("i");
                const TARGET_VOL = 0.5;
                const STORAGE_KEY = "inv_has_opened"; // "1" jika user pernah klik Buka Undangan

                function showMusicBtn() {
                    btn.classList.add("is-visible");
                }
                function hideMusicBtn() {
                    btn.classList.remove("is-visible");
                }
                function setPlayingUI(isPlaying) {
                    btn.setAttribute("aria-pressed", String(isPlaying));
                    btn.setAttribute(
                        "aria-label",
                        isPlaying ? "Pause music" : "Play music"
                    );
                    icon.className = isPlaying
                        ? "fa-solid fa-pause"
                        : "fa-solid fa-play";
                }
                function fadeTo(volTarget = TARGET_VOL, ms = 900) {
                    return new Promise((resolve) => {
                        const start = audio.volume,
                            diff = volTarget - start;
                        if (Math.abs(diff) < 0.001) return resolve();
                        const steps = Math.max(1, Math.round(ms / 50));
                        let i = 0;
                        (function tick() {
                            i++;
                            audio.volume = Math.max(
                                0,
                                Math.min(1, start + diff * (i / steps))
                            );
                            i >= steps ? resolve() : setTimeout(tick, 50);
                        })();
                    });
                }
                async function playWithFade() {
                    try {
                        audio.volume = 0;
                        await audio.play(); // jika diblokir, catch
                        await fadeTo(TARGET_VOL, 1200);
                        setPlayingUI(true);
                    } catch (e) {
                        console.debug("audio play blocked:", e);
                        setPlayingUI(false); // tombol tetap tampil untuk manual
                    }
                }
                async function pauseWithFade() {
                    await fadeTo(0, 200);
                    audio.pause();
                    setPlayingUI(false);
                }

                // init
                audio.volume = TARGET_VOL;

                const hasOpenedBefore =
                    localStorage.getItem(STORAGE_KEY) === "1";
                if (hasOpenedBefore) {
                    showMusicBtn(); // selalu tampilkan tombol jika pernah membuka
                    playWithFade(); // coba auto-play (kalau gagal, user klik manual)
                } else {
                    hideMusicBtn(); // sembunyikan sampai user klik Buka Undangan
                    setPlayingUI(false);
                }

                // Toggle manual
                btn.addEventListener("click", async () => {
                    if (audio.paused) await playWithFade();
                    else await pauseWithFade();
                });

                // Saat "Buka Undangan" diklik ‚Üí simpan flag + tampilkan tombol + play
                document.addEventListener(
                    "click",
                    async (e) => {
                        const openBtn = e.target.closest(".btn-enter");
                        if (!openBtn) return;
                        try {
                            localStorage.setItem(STORAGE_KEY, "1");
                        } catch {}
                        showMusicBtn();
                        if (audio.paused) await playWithFade();
                    },
                    true
                );
            })();
        </script>

        <script>
            // AOS Animation
            AOS.init();
        </script>
    </body>
</html>
